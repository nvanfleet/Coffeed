TODO 
#=======================

	- Fault mode when there is no chip data
	- Are you freeing the socket correctly?
    - Logging should use a circular buffer

ver 2.0 What's new
    - Socket API (threaded)
    - PWM support for heating
    - Better logging
    - A million different things
    
ver 0.9
    - No socket support
    - PWM roughly calculated
    - Crude logging


#=======================

svn co svn://svn.openwrt.org/openwrt/trunk/ trunk

svn co svn://svn.openwrt.org/openwrt/branches/backfire/ backfire

./scripts/feeds update -a

#=======================
30 5 * * 1-5 /etc/init.d/pidd start
30 8 * * 1-5 /etc/init.d/pidd stop
00 7 * * 0,6 /etc/init.d/pidd start
00 14 * * 0,6 /etc/init.d/pidd stop

#=======================
REDBOOT configure

fconfig -l

fconfig bootp_my_ip 192.168.1.1
fconfig bootp_my_ip_mask 255.255.255.0
fconfig bootp_my_gateway_ip 192.168.1.11
fconfig bootp_server_ip 192.168.1.11
fconfig console_baud_rate 9600

fconfig boot_script_data 
check_mac
fis load -d linux
exec

#=======================
REDBOOT install Openwrt within Openwrt

cd /tmp

#KERNEL
scp 192.168.1.64:/var/www/html/openwrt-atheros-vmlinux.gz .
mtd -e linux write openwrt-atheros-vmlinux.gz linux
rm openwrt-atheros-vmlinux.gz

#SQUASHFS
scp 192.168.1.64:/var/www/html/openwrt-atheros-root.squashfs .
mtd -e rootfs write openwrt-atheros-root.squashfs rootfs

#JFFS
scp 192.168.1.64:/var/www/html/openwrt-atheros-root.jffs2-64k .
mtd -e rootfs write openwrt-atheros-root.jffs2-64k rootfs

reboot

#=======================
GET APP

scp 192.168.1.64:/var/www/html/coffeec_1.0-1_atheros.ipk /tmp/
scp 192.168.1.64:/var/www/html/coffeed_1.0-1_atheros.ipk /tmp/

#=======================
REDBOOT install Openwrt

//KERNEL
load -r -b %{FREEMEMLO} -m http -h 192.168.1.64 /openwrt-atheros-vmlinux.gz
fis init
fis create -r 0x80041000 -e 0x80041000 linux

//KERNEL don't use
load -r -b %{FREEMEMLO} -m http -h 192.168.1.64 /openwrt-atheros-vmlinux.lzma
fis init
fis create -r 0x80041000 -e 0x80041000 linux

//SQUASHFS
load -r -b %{FREEMEMLO} -m http -h 192.168.1.64 /openwrt-atheros-root.squashfs
fis create rootfs

//JFFS
load -r -b %{FREEMEMLO} -m http -h 192.168.1.64 /openwrt-atheros-root.jffs2-64k
fis create rootfs


openwrt-jffs2-64k
#=======================
SYSTEM 1 kmod

    1. You need to establish your GPIO pins for i2c
    This example is using pins SCLK = 0 and SDA = 1
        insmod i2c-gpio-custom bus0=0,1,0
    
    Make lsmod entry (permanent after reboot)
        echo 'i2c-gpio-custom bus0=0,1,0' > /etc/modules.d/60-i2c-gpio-custom
    
    2. You need to establish you GPIO pins for PWM (heater control)
    Below is a loader for using pin 2 for the heater and making bus 0
        insmod pwm-gpio-custom bus0=0,2

    Make lsmod entry (permanent after reboot)
        echo 'pwm-gpio-custom bus0=0,2' > /etc/modules.d/61-pwm-gpio-custom

#=======================
SYSTEM 2 remove services

/etc/init.d/led stop; /etc/init.d/led disable
/etc/init.d/firewall disable; /etc/init.d/firewall stop
/etc/init.d/dnsmasq disable; /etc/init.d/dnsmasq stop

#=======================

dd if=/dev/mtdblock1 of=stage2.bin

Name              FLASH addr  Mem addr    Length      Entry point
RedBoot           0xA8000000  0xA8000000  0x00030000  0x00000000
stage2            0xA8030000  0x80100000  0x00020000  0x80100000
FIS directory     0xA87D0000  0xA87D0000  0x0000F000  0x00000000
RedBoot config    0xA87DF000  0xA87DF000  0x00001000  0x00000000

Name              FLASH addr  Mem addr    Length      Entry point
RedBoot           0xA8000000  0xA8000000  0x00030000  0x00000000
linux             0xA8150000  0x80041000  0x00340000  0x80041000
rootfs            0xA8490000  0x80041000  0x00340000  0x80041000
FIS directory     0xA87D0000  0xA87D0000  0x0000F000  0x00000000
RedBoot config    0xA87DF000  0xA87DF000  0x00001000  0x00000000

Name              FLASH addr  Mem addr    Length      Entry point
RedBoot           0xA8000000  0xA8000000  0x00030000  0x00000000
stage2            0xA8030000  0x80100000  0x00020000  0x80100000
linux             0xA8050000  0x80041000  0x000D0000  0x80041000
rootfs            0xA8120000  0x8003C000  0x00160000  0x8003C000
FIS directory     0xA87D0000  0xA87D0000  0x0000F000  0x00000000
RedBoot config    0xA87DF000  0xA87DF000  0x00001000  0x00000000
